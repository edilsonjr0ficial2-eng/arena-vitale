<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin | Arena Vitale</title>
    <link rel="icon" href="logo2.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #111; --card: #222; --primary: #FFD700; --text: #fff; --danger: #ff4d4d; --success: #4dff88; }
        body.light-mode { --bg: #f4f4f4; --card: #fff; --text: #000; --primary: #e6c300; }
        body.light-mode .slot, body.light-mode table th, body.light-mode table td { border-color: #ccc; }
        
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Montserrat', sans-serif; }
        body { background: var(--bg); color: var(--text); padding: 20px; transition: 0.3s; }

        .header { display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 20px; }
        .top-row { display: flex; justify-content: space-between; align-items: center; }
        .logo-img { max-height: 70px; width: auto; display: block; }
        
        .toolbar { display: flex; gap: 10px; flex-wrap: wrap; }
        .tool-btn { padding: 8px 12px; border-radius: 5px; border: 1px solid #555; background: var(--card); color: var(--text); cursor: pointer; font-size: 0.85rem; display: flex; align-items: center; gap: 5px; font-weight: bold; transition: 0.2s; }
        .tool-btn:hover { border-color: var(--primary); color: var(--primary); }
        .btn-logout { background: var(--danger); border: none; color: white; }

        .stats-bar { display: flex; gap: 20px; background: var(--card); padding: 10px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #333; font-size: 0.9rem; justify-content: space-around; }
        .stat-item span { color: var(--primary); font-weight: 900; font-size: 1.1rem; }

        .controls { display: flex; gap: 15px; align-items: center; justify-content: center; margin-bottom: 20px; background: var(--card); padding: 10px; border-radius: 10px; }
        .nav-btn { background: none; border: 1px solid #555; color: var(--primary); font-size: 1.2rem; cursor: pointer; padding: 5px 15px; border-radius: 5px; }
        .date-display { font-size: 1.1rem; font-weight: bold; text-transform: uppercase; }

        .grid-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; max-width: 1200px; margin: auto; }
        .column { background: var(--card); border-radius: 10px; overflow: hidden; border: 1px solid #333; }
        .col-header { background: var(--primary); color: #000; padding: 10px; text-align: center; font-weight: 900; text-transform: uppercase; font-size: 0.9rem; }
        
        .slot { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; border-bottom: 1px solid #333; font-size: 0.85rem; }
        .time-label { font-weight: bold; color: #777; width: 50px; }
        .slot-content { flex: 1; text-align: left; padding-left: 5px; font-weight: 500; color: #ccc; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .slot-content.booked { color: var(--primary); font-weight: bold; }
        
        .actions { display: flex; gap: 5px; }
        .btn-icon { border: none; background: none; cursor: pointer; font-size: 1rem; transition: 0.2s; padding: 2px; }
        .btn-add { color: #555; } .btn-add:hover { color: var(--success); }
        .btn-del { color: var(--danger); } .btn-del:hover { transform: scale(1.2); }
        .btn-wa { color: var(--success); } .btn-wa:hover { transform: scale(1.2); }
        .btn-pay { color: #ccc; opacity: 0.3; } .btn-pay.paid { color: var(--success); opacity: 1; } .btn-pay:hover { opacity: 1; }

        #loginOverlay, .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 3000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .modal-bg { background: rgba(0,0,0,0.8); z-index: 2000; display: none; }
        .login-box, .modal-box { background: var(--card); padding: 30px; border-radius: 10px; border: 2px solid var(--primary); width: 90%; max-width: 400px; text-align: center; }
        
        /* TABELA DE INTERDI√á√ÉO */
        .interdicao-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; max-height: 300px; overflow-y: auto; text-align: left; }
        .interdicao-item { background: #333; padding: 8px; border-radius: 5px; display: flex; align-items: center; gap: 10px; font-size: 0.9rem; }
        .interdicao-item input { width: auto; margin: 0; }

        /* ESTILOS SORTEIO */
        .sorteio-display { font-size: 2rem; font-weight: 900; color: var(--primary); margin: 30px 0; min-height: 60px; text-transform: uppercase; }
        .confetti { color: var(--success); font-size: 1.5rem; margin-top: 10px; display: none; }

        .blacklist-container { max-height: 200px; overflow-y: auto; margin-top: 15px; border-top: 1px solid #333; padding-top: 10px; text-align: left; }
        .black-item { display: flex; justify-content: space-between; align-items: center; background: #333; margin-bottom: 5px; padding: 8px; border-radius: 5px; font-size: 0.85rem; border: 1px solid #444; }
        
        input, select { width: 100%; padding: 12px; margin: 10px 0; background: #111; border: 1px solid #444; color: white; border-radius: 5px; }
        .checkbox-wrapper { display: flex; align-items: center; gap: 10px; margin: 10px 0; font-size: 0.9rem; color: #ccc; }
        button.primary-btn { padding: 10px 20px; font-size: 1rem; background: var(--primary); border: none; border-radius: 5px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px;}
        button.close-btn { background: #333; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; margin-top: 5px; width: 100%; }

        @media print { body { background: white; color: black; } .header, .controls, .actions, .toolbar, #loginOverlay { display: none !important; } .column { border: 1px solid #000; background: white; } .col-header { background: #eee !important; color: black !important; -webkit-print-color-adjust: exact; } .slot-content { color: black; } #printHeader { display: block !important; } }
        #printHeader { display: none; }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div class="login-box">
            <img src="logo2.png" alt="Arena Vitale" class="logo-img" style="margin: 0 auto 15px auto;">
            <input type="password" id="passInput" placeholder="Senha">
            <button class="primary-btn" onclick="tentarLogin()">ACESSAR</button>
        </div>
    </div>

    <div id="printHeader">AGENDA DO DIA <span id="printDate"></span></div>

    <div class="header">
        <div class="top-row">
            <img src="logo2.png" alt="Arena Vitale" class="logo-img">
            <button class="tool-btn btn-logout" onclick="fazerLogout()">Sair üö™</button>
        </div>
        
        <div class="toolbar">
            <button class="tool-btn" onclick="window.open('index.html', '_blank')">üåê Ver Site</button>
            <button class="tool-btn" onclick="gerarRelatorio('clientes')">üë• Clientes</button>
            <button class="tool-btn" onclick="abrirModalSorteio()">üéÅ Sorteio</button>
            <button class="tool-btn" onclick="gerarRelatorio('blacklist')">üìú Lista Negra</button>
            <button class="tool-btn" onclick="copiarAgenda()">üìã Copiar p/ Grupo</button>
            <button class="tool-btn" onclick="abrirModalInterdicao()">‚õî Interditar Hor√°rios</button>
            <button class="tool-btn" onclick="abrirModalAddBloqueio()">‚ûï Add Bloqueio</button>
            <button class="tool-btn" onclick="alternarModo()">üåó Sol/Sombra</button>
            <button class="tool-btn" onclick="window.print()">üñ®Ô∏è Imprimir</button>
        </div>
    </div>

    <div class="stats-bar">
        <div class="stat-item">Ocupa√ß√£o: <span id="statOcupacao">0%</span></div>
        <div class="stat-item">Faturamento (Est.): <span id="statFaturamento">R$ 0,00</span></div>
    </div>

    <div class="controls">
        <button class="nav-btn" onclick="mudarDia(-1)">‚ùÆ</button>
        <div class="date-display" id="dateDisplay">...</div>
        <button class="nav-btn" onclick="mudarDia(1)">‚ùØ</button>
        <button class="nav-btn" onclick="carregarAgenda()" style="margin-left:10px;">‚Üª</button>
    </div>

    <div class="grid-container">
        <div class="column"><div class="col-header">üéæ Chicashoes</div><div id="listaQ1"></div></div>
        <div class="column"><div class="col-header">ü•ê Panificadora</div><div id="listaQ2"></div></div>
    </div>

    <div id="modalManual" class="modal-bg">
        <div class="modal-box">
            <h3 style="color:var(--primary)">Novo Agendamento</h3>
            <p id="modalInfo" style="margin:10px 0; color:#aaa; font-size:0.9rem;"></p>
            <input type="text" id="manualNome" placeholder="Nome do Jogador / Bloqueio">
            <div class="checkbox-wrapper">
                <input type="checkbox" id="checkMensalista" style="width:auto;">
                <label>Marcar como Mensalista (M)</label>
            </div>
            <button class="primary-btn" onclick="salvarManual()">SALVAR</button>
            <button class="close-btn" onclick="fecharModal()">Cancelar</button>
        </div>
    </div>

    <div id="modalAddBlacklist" class="modal-bg">
        <div class="modal-box">
            <h3 style="color:var(--danger)">Adicionar √† Lista Negra</h3>
            <input type="text" id="blNome" placeholder="Nome do Bloqueado">
            <input type="tel" id="blTel" placeholder="Telefone (apenas n√∫meros)">
            <button class="primary-btn" style="background:var(--danger); color:white;" onclick="adicionarBloqueio()">CONFIRMAR BLOQUEIO</button>
            <button class="close-btn" onclick="document.getElementById('modalAddBlacklist').style.display='none'">Fechar</button>
        </div>
    </div>

    <div id="modalInterdicao" class="modal-bg">
        <div class="modal-box" style="max-width:500px;">
            <h3 style="color:var(--danger)">Interditar Hor√°rios</h3>
            <p style="color:#aaa; font-size:0.8rem; margin-bottom:10px;">Selecione os hor√°rios para fechar.</p>
            <div style="display:flex; gap:10px; justify-content:center; margin-bottom:10px;">
                <button onclick="marcarTodos(true)" style="font-size:0.8rem; padding:5px 10px; cursor:pointer;">Marcar Todos</button>
                <button onclick="marcarTodos(false)" style="font-size:0.8rem; padding:5px 10px; cursor:pointer;">Desmarcar Todos</button>
            </div>
            <div class="interdicao-grid" id="listaInterdicao"></div>
            <button class="primary-btn" style="background:var(--danger); color:white;" onclick="confirmarInterdicao()">‚õî INTERDITAR SELECIONADOS</button>
            <button class="close-btn" onclick="document.getElementById('modalInterdicao').style.display='none'">Cancelar</button>
        </div>
    </div>

    <div id="modalSorteio" class="modal-bg">
        <div class="modal-box">
            <h3 style="color:var(--primary)">Sorteio de Clientes üé≤</h3>
            <p style="color:#aaa;">Sorteie um cliente da base cadastrada.</p>
            
            <div id="displaySorteio" class="sorteio-display">...</div>
            <div id="confetti" class="confetti">üéâ PARAB√âNS! üéâ</div>
            
            <button id="btnSortear" class="primary-btn" onclick="realizarSorteio()">SORTEAR AGORA</button>
            <button class="close-btn" onclick="document.getElementById('modalSorteio').style.display='none'">Fechar</button>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx4Dj4kUKuY9Ji7FP-q5dMZLYESHW1XDW7jTCvnM9xl6RnYi8Z6aISv31ytR3klMCCa/exec"; 
        const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTTlYbHI9mgBo8JbEzXjCddY-w5LJqZdFQDiKy1XkJS5m4mkRPoj0CCgTN5WldIRH-ciFxev14TRijP/pub?output=csv";
        const SENHA_ADMIN = "admin123"; 

        let dataAtual = new Date();
        const horas = [7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22];
        const diasSemana = ['Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado', 'Domingo'];
        let dadosAgenda = [];
        let tempAgendamento = {};

        window.onload = function() {
            if(localStorage.getItem('adminAuth') === SENHA_ADMIN) {
                document.getElementById('loginOverlay').style.display = 'none';
                aplicarTemaSalvo();
                carregarAgenda();
            }
        };

        function tentarLogin() {
            if(document.getElementById('passInput').value === SENHA_ADMIN) {
                localStorage.setItem('adminAuth', SENHA_ADMIN);
                document.getElementById('loginOverlay').style.display = 'none';
                aplicarTemaSalvo();
                carregarAgenda();
            } else alert("Senha incorreta!");
        }

        function fazerLogout() { localStorage.removeItem('adminAuth'); location.reload(); }
        function alternarModo() { document.body.classList.toggle('light-mode'); localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark'); }
        function aplicarTemaSalvo() { if(localStorage.getItem('theme') === 'light') document.body.classList.add('light-mode'); }
        function mudarDia(delta) { dataAtual.setDate(dataAtual.getDate() + delta); carregarAgenda(); }
        function formatarData(date) {
            let diaIndex = date.getDay() === 0 ? 6 : date.getDay() - 1;
            let dia = String(date.getDate()).padStart(2, '0');
            let mes = String(date.getMonth() + 1).padStart(2, '0');
            return { texto: `${diasSemana[diaIndex]} - ${dia}/${mes}`, index: diaIndex };
        }

        // --- RELAT√ìRIOS ---
        function gerarRelatorio(tipo) {
            let win = window.open("", "_blank");
            win.document.write("<html><body style='background:#111;color:#fff;font-family:sans-serif;'><h2>Carregando dados...</h2></body></html>");

            fetch(SCRIPT_URL, {
                method: "POST",
                body: JSON.stringify({ acao: tipo === 'clientes' ? "listar_clientes" : "listar_blacklist" })
            })
            .then(r => r.json())
            .then(data => {
                let titulo = tipo === 'clientes' ? "Relat√≥rio de Clientes" : "Relat√≥rio da Lista Negra";
                let html = `<html><head><title>${titulo}</title><style>body{font-family:'Segoe UI',sans-serif;background:#1a1a1a;color:#fff;padding:20px;}h1{color:#FFD700;border-bottom:2px solid #333;padding-bottom:10px;}table{width:100%;border-collapse:collapse;margin-top:20px;background:#222;}th,td{padding:12px;border:1px solid #444;text-align:left;}th{background:#FFD700;color:#000;font-weight:bold;}tr:nth-child(even){background:#2a2a2a;}tr:hover{background:#333;}</style></head><body><h1>${titulo}</h1><table>`;

                if (tipo === 'clientes') {
                    html += `<thead><tr><th>Data Cadastro</th><th>Nome</th><th>Telefone</th><th>Senha</th><th>√öltimo Acesso</th></tr></thead><tbody>`;
                    for(let i = 1; i < data.lista.length; i++) {
                        let row = data.lista[i];
                        let dataF = row[0] ? new Date(row[0]).toLocaleDateString() : "-";
                        html += `<tr><td>${dataF}</td><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td><td>${row[4]}</td></tr>`;
                    }
                } else {
                    html += `<thead><tr><th>Nome Bloqueado</th><th>Telefone Bloqueado</th></tr></thead><tbody>`;
                    for(let i = 0; i < data.lista.length; i++) {
                        let row = data.lista[i];
                        html += `<tr><td>${row[0]}</td><td>${row[1]}</td></tr>`;
                    }
                }
                html += `</tbody></table><br><button onclick="window.close()" style="padding:10px 20px;cursor:pointer;">Fechar Aba</button></body></html>`;
                win.document.open(); win.document.write(html); win.document.close();
            })
            .catch(e => { win.document.body.innerHTML = "<h2 style='color:red'>Erro ao carregar dados.</h2>"; });
        }

        // --- SORTEIO ---
        function abrirModalSorteio() {
            document.getElementById('modalSorteio').style.display = 'flex';
            document.getElementById('displaySorteio').innerText = "???";
            document.getElementById('confetti').style.display = 'none';
            document.getElementById('btnSortear').disabled = false;
            document.getElementById('btnSortear').innerText = "SORTEAR AGORA";
        }

        function realizarSorteio() {
            const btn = document.getElementById('btnSortear');
            const display = document.getElementById('displaySorteio');
            btn.disabled = true;
            btn.innerText = "Sorteando...";
            
            // Efeito visual de embaralhar
            let timer = setInterval(() => {
                display.innerText = "Sorteando..."; 
                display.style.opacity = Math.random() > 0.5 ? 1 : 0.5;
            }, 100);

            fetch(SCRIPT_URL, {
                method: "POST",
                body: JSON.stringify({ acao: "sortear_cliente" })
            })
            .then(r => r.json())
            .then(data => {
                clearInterval(timer);
                display.style.opacity = 1;
                
                if (data.erro) {
                    display.innerText = "Erro";
                    alert(data.erro);
                    btn.disabled = false;
                    btn.innerText = "Tentar Novamente";
                } else {
                    let v = data.vencedor;
                    display.innerHTML = `${v.nome}<br><span style="font-size:1rem;color:#ccc;">${v.telefone}</span>`;
                    document.getElementById('confetti').style.display = 'block';
                    btn.innerText = "Sorteio Conclu√≠do";
                }
            })
            .catch(e => {
                clearInterval(timer);
                display.innerText = "Erro de conex√£o";
                btn.disabled = false;
            });
        }

        // --- INTERDI√á√ÉO SELETIVA ---
        function abrirModalInterdicao() {
            document.getElementById('modalInterdicao').style.display = 'flex';
            let html = "";
            horas.forEach(h => {
                html += `
                    <div class="interdicao-item">
                        <input type="checkbox" class="chk-interdicao" data-hora="${h}" data-quadra="1"> 
                        <label>${h}:00 - Chicashoes</label>
                    </div>
                    <div class="interdicao-item">
                        <input type="checkbox" class="chk-interdicao" data-hora="${h}" data-quadra="2"> 
                        <label>${h}:00 - Panificadora</label>
                    </div>
                `;
            });
            document.getElementById('listaInterdicao').innerHTML = html;
        }

        function marcarTodos(status) { document.querySelectorAll('.chk-interdicao').forEach(chk => chk.checked = status); }

        function confirmarInterdicao() {
            let selecionados = [];
            document.querySelectorAll('.chk-interdicao:checked').forEach(chk => {
                selecionados.push({ hora: chk.getAttribute('data-hora'), quadra: chk.getAttribute('data-quadra') });
            });
            if(selecionados.length === 0) return alert("Selecione pelo menos um hor√°rio.");
            if(confirm(`Interditar ${selecionados.length} hor√°rios selecionados?`)) {
                enviarFetch({ acao: "bloqueio_lote", itens: selecionados, diaIndex: formatarData(dataAtual).index });
                document.getElementById('modalInterdicao').style.display='none';
            }
        }

        // --- AGENDA E CSV ---
        async function carregarAgenda() {
            const info = formatarData(dataAtual);
            document.getElementById('dateDisplay').innerText = info.texto;
            document.getElementById('printDate').innerText = info.texto;
            document.getElementById('listaQ1').innerHTML = '<div style="padding:10px;text-align:center;">‚Üª</div>';
            document.getElementById('listaQ2').innerHTML = '<div style="padding:10px;text-align:center;">‚Üª</div>';
            try {
                const response = await fetch(SHEET_URL + '&t=' + new Date().getTime());
                const csv = await response.text();
                processarCSV(csv, info.index);
            } catch (e) { console.error(e); }
        }

        function processarCSV(csv, diaIndex) {
            const rows = csv.split('\n').map(r => r.split(','));
            dadosAgenda = []; let ocupados = 0;
            rows.forEach((row, idx) => {
                if(idx === 0) return;
                let h = parseInt(row[0]);
                if(!isNaN(h)) {
                    let colQ1 = 1 + diaIndex; let colQ2 = 9 + diaIndex;
                    let nomeQ1 = row[colQ1] ? row[colQ1].replace(/[\r\n"]/g, '').trim() : "";
                    let nomeQ2 = row[colQ2] ? row[colQ2].replace(/[\r\n"]/g, '').trim() : "";
                    if(nomeQ1) ocupados++; if(nomeQ2) ocupados++;
                    dadosAgenda.push({ hora: h, q1: nomeQ1, q2: nomeQ2 });
                }
            });
            atualizarEstatisticas(ocupados);
            renderizarGrid();
        }

        function atualizarEstatisticas(ocupados) {
            let totalSlots = horas.length * 2; let porcentagem = Math.round((ocupados / totalSlots) * 100);
            document.getElementById('statOcupacao').innerText = porcentagem + "%";
            document.getElementById('statFaturamento').innerText = "R$ " + (ocupados * 45).toFixed(2).replace('.', ',');
        }

        function renderizarGrid() {
            let htmlQ1 = ""; let htmlQ2 = "";
            horas.forEach(h => {
                let slot = dadosAgenda.find(d => d.hora === h) || { q1: "", q2: "" };
                htmlQ1 += criarSlotHTML(h, 1, slot.q1);
                htmlQ2 += criarSlotHTML(h, 2, slot.q2);
            });
            document.getElementById('listaQ1').innerHTML = htmlQ1;
            document.getElementById('listaQ2').innerHTML = htmlQ2;
        }

        function criarSlotHTML(hora, quadra, nome) {
            let ocupado = nome.length > 0;
            let conteudo = ocupado ? `<span class="booked">${nome}</span>` : "Livre";
            let botoes = ocupado 
                ? `<button class="btn-icon btn-wa" onclick="abrirWhatsApp('${nome}', ${hora})">üìû</button>
                   <button class="btn-icon btn-pay ${nome.includes('‚úÖ') ? 'paid' : ''}" onclick="togglePago(${hora}, ${quadra}, '${nome}')">üí≤</button>
                   <button class="btn-icon btn-del" onclick="cancelar(${hora}, ${quadra}, '${nome}')">üóëÔ∏è</button>`
                : `<button class="btn-icon btn-add" onclick="abrirManual(${hora}, ${quadra})">‚ûï</button>`;
            return `<div class="slot"><span class="time-label">${hora}:00</span><div class="slot-content ${ocupado ? 'booked' : ''}">${conteudo}</div><div class="actions">${botoes}</div></div>`;
        }

        function abrirModalAddBloqueio() { document.getElementById('modalAddBlacklist').style.display = 'flex'; }
        
        function adicionarBloqueio() {
            const nome = document.getElementById('blNome').value; const tel = document.getElementById('blTel').value;
            if(!nome) return alert("Digite o nome.");
            if(confirm(`Bloquear ${nome}?`)) {
                enviarFetch({ acao: "bloquear", nome: nome, telefone: tel });
                document.getElementById('blNome').value = ""; document.getElementById('blTel').value = "";
                document.getElementById('modalAddBlacklist').style.display='none';
            }
        }

        function enviarFetch(dadosJSON) {
            fetch(SCRIPT_URL, { method: "POST", mode: "no-cors", headers: { "Content-Type": "text/plain;charset=utf-8" }, body: JSON.stringify(dadosJSON) })
            .then(() => setTimeout(carregarAgenda, 2000))
            .catch(e => alert("Erro ao comunicar."));
        }
        
        function abrirWhatsApp(nome, hora) {
            let num = prompt(`N√∫mero de ${nome}:`, "");
            if(num) window.open(`https://wa.me/55${num}?text=${encodeURIComponent(`Ol√° ${nome}, confirmando ${hora}h üéæ`)}`, '_blank');
        }
        function togglePago(hora, quadra, nome) {
            let novo = nome.includes("‚úÖ") ? nome.replace(/ ?‚úÖ/g, "") : nome + " ‚úÖ";
            enviarComando("agendar", hora, quadra, novo);
        }
        function abrirManual(hora, quadra) {
            tempAgendamento = { hora, quadra };
            document.getElementById('modalInfo').innerText = `${hora}:00 - Quadra ${quadra}`;
            document.getElementById('manualNome').value = ""; document.getElementById('checkMensalista').checked = false;
            document.getElementById('modalManual').style.display = 'flex'; document.getElementById('manualNome').focus();
        }
        function fecharModal() { document.getElementById('modalManual').style.display = 'none'; }
        function salvarManual() {
            let nome = document.getElementById('manualNome').value;
            if(!nome) return alert("Nome?");
            if(document.getElementById('checkMensalista').checked) nome += " (M)";
            enviarComando("agendar", tempAgendamento.hora, tempAgendamento.quadra, nome); fecharModal();
        }
        function cancelar(hora, quadra, nome) { if(confirm(`Apagar ${nome}?`)) enviarComando("cancelar", hora, quadra, ""); }
        function enviarComando(acao, hora, quadra, nome) {
            let index = dadosAgenda.findIndex(d => d.hora === hora);
            if(index === -1) { dadosAgenda.push({hora, q1:"", q2:""}); index = dadosAgenda.length -1; }
            if(quadra === 1) dadosAgenda[index].q1 = (acao === "agendar" ? nome : ""); else dadosAgenda[index].q2 = (acao === "agendar" ? nome : "");
            renderizarGrid();
            enviarFetch({ acao: acao, nome: nome, diaIndex: formatarData(dataAtual).index, hora: hora, quadra: quadra, duracao: 1 });
        }
    </script>
</body>
</html>
